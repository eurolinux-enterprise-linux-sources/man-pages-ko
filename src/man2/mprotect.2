.\" -*- nroff -*- 
.\"
.\" Copyright (C) 1995 Michael Shields <shields@tembel.org>.
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and author of this work.
.\"
.\" Modified Tue Oct 22 08:11:14 EDT 1996 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified Sat May 31 15:32:03 MET 1997 by Andries Brouwer <aeb@cwi.nl>
.\"
.TH MPROTECT 2 "1997년 05월 31일" "리눅스 2.0" "리눅스 프로그래머 매뉴얼"
.SH 이름
mprotect \- 메모리 영역에 대한 접근를 제어한다.
.SH 사용법
.nf
.B #include <sys/mman.h>
.sp
\fBint mprotect(const void *\fIaddr\fB, size_t \fIlen\fB, int \fIprot\fB);
.fi
.SH 설명
.BR mprotect 는 
메모리 영역에 대한 접근을 제어한다.
만일 그 영역을 보호하기 위해 접근이 허용되지 않는다면, 프로그램은 
.BR SIGSEGV 를 
받는다.
.PP
.IR prot 는 
다음 값들의 비트 OR이다:
.TP 1.1i
.B PROT_NONE
메모리를 접근할 수 없다.
.TP
.B PROT_READ
메모리를 읽을 수 있다.
.TP
.B PROT_WRITE
메모리를 쓸 수 있다.
.TP
.B PROT_EXEC
메모리에 실행 코드를 둘 수 있다.
.PP
새로 설정한 보호 모드는 기존의 보호 모드를 대체한다.
예를 들어, 이전에 메모리가 \fBPROT_READ\fR로 표시되어 있는데,
\fBmprotect\fR가 \fIprot\fR를 \fBPROT_WRITE\fR로 호출된다면,
그 영역은 더 이상 읽기 전용이 아니다.
.SH 반환값
성공시, 
.BR mprotect 는 
0을 리턴한다. 에러시, \-1이 리턴되며, 
.IR errno 는 
적당한 값으로 설정된다.
.SH 에러
.TP
.B EINVAL
\fIaddr\fR가 유효한 포인터가 아니거나, 또는 PAGESIZE의 배수가 아니다.
.TP
.B EFAULT
메모리를 접근할 수 없다.
.TP
.B EACCES
메모리가 지정된 모드로 설정될 수 없다.
예를 들어, 읽기 전용 접근을 하도록 파일을 
.BR mmap (2)
했는데
.BR mprotect 가 
.BR PROT_WRITE 를 
요청할 때 발생한다.
.TP
.B ENOMEM
내부 커널 구조체를 할당할 수 없다.
.SH 예제
.nf
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <sys/mman.h>

#include <limits.h>    /* PAGESIZE 때문에 */
#ifndef PAGESIZE
#define PAGESIZE 4096
#endif

int
main(void)
{
    char *p;
    char c;

    /* 버퍼를 할당한다; 기본적으로 PROT_READ|PROT_WRITE
	   보호 모드로 설정된다. */
    p = malloc(1024+PAGESIZE-1);
    if (!p) {
        perror("Couldn't malloc(1024)");
        exit(errno);
    }

	/* PAGESIZE의 배수가 되도록 정렬; 2의 제곱으로 가정한다. */
    p = (char *)(((int) p + PAGESIZE-1) & ~(PAGESIZE-1));

    c = p[666];         /* 읽기; ok */
    p[666] = 42;        /* 쓰기; ok */

	/* 버퍼를 읽기 전용으로 한다. */
    if (mprotect(p, 1024, PROT_READ)) {
        perror("Couldn't mprotect");
        exit(errno);
    }

    c = p[666];         /* 읽기; ok */
    p[666] = 42;        /* 쓰기; 프로그램은 SIGSEGV로 죽는다. */

    exit(0);
}
.fi
.SH 호환
SVr4, POSIX.1b (공식적으로 POSIX.4).  SVr4는 EAGAIN 에러 코드을 추가적으로 
정의한다. SVr4 에러 조건은 리눅스와 정확히 대응되지는 않는다.
POSIX.1b에서는 
.BR mprotect 는
.BR mmap (2) 으로 
확보한 메모리 영역에서만 사용될 수 있다고 말한다.
.SH 관련 항목
.BR mmap (2)
.SH 역자
정강훈 <skyeyes@soback.kornet.net>, 2000년 5월 15일
