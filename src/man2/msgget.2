.\" Copyright 1993 Giorgio Ciucci <giorgio@crcc.it>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Added correction due to Nick Duffek <nsd@bbc.com>, aeb, 960426
.\" Modified Wed Nov  6 04:00:31 1996 by Eric S. Raymond <esr@thyrsus.com>
.\"
.\"
.\" 한국어 번역: 정강훈 <skyeyes@soback.kornet.net> 2000년 6월 19일
.\"
.\" r1.2 2005-02-15 20:20:17 +13-5 윤현호
.\" manpage 정리  
.\" r1.1 2004-08-10 21:38:00  xaos
.\"
.TH MSGGET 2 "1993년 11월 1일" "Linux 0.99.13" "리눅스 프로그래머 매뉴얼"
.SH 이름
msgget \- 메세지 큐 식별자를 가져온다.
.SH 사용법
.nf
.B
# include <sys/types.h>
.B
# include <sys/ipc.h>
.B
# include <sys/msg.h>
.fi
.sp
.BI "int msgget ( key_t " key ,
.BI "int "msgflg " )"
.SH 설명
이 함수는
.I key
값과 관련된 메세지 큐 식별자를 반환한다.
만일,
.IR key 가
.B IPC_PRIVATE
값을 가지고 있거나 또는
.IR key 가
.BR IPC_PRIVATE 가
아니고,
.IR key 와
연계되어 있는 메세지 큐가 없다면 새로운 메세지 큐가 만들어지며
.BR IPC_CREAT 는
.IR msgflg 에
명시되어 있다.
(i.e.
.IB msgflg & IPC_CREAT
는 0이 아니다.)

.IR msgflg 에
존재하는
.BR IPC_CREAT 와
.B IPC_EXCL
필드는
.BR open (2)시스템
호출의 모드 인자에서
.BR O_CREAT 와
.BR O_EXCL 이
있는 것처럼 메세지 큐의 존재에 대해 같은 역할을 한다.:
만일
.IR msgflg 가
.BR IPC_CREAT 와
.BR IPC_EXCL 이고
.IR key 를
위한 메세지 큐가 이미 존재한다면,
.B msgget
시스템 콜은 실패한다.
.PP
생성시,
.I msgflg
인자의 하위 9비트는 메세지 큐에 대한 접근 허가권을 정의한다.
이 허가권은
.BR open (2)이나
.BR creat (2) 시스템
콜에 있는 접근 허가권과 같은 형태, 같은 의미를 가진다.
(실행 허가권은 사용되지 않는다.)
.PP
더군다나, 생성하는 동안,
시스템 콜은 다음과 같은 시스템 메세지 큐 데이터 구조체
.BR msqid_ds 를
초기화 한다.
.IP
.BR msg_perm.cuid 와
.BR msg_perm.uid 는
호출 프로세스의 유효 사용자\-ID로 설정된다.
.IP
.BR msg_perm.cgid 와
.BR msg_perm.gid 는
호출 프로세스의 유효 그룹\-ID로 설정된다.
.IP
.BR msg_perm.mode 의
하위 9비트는
.IR msgflg 의
하위 9비트로 설정된다.
.IP
.BR msg_qnum ,
.BR msg_lspid ,
.BR msg_lrpid ,
.BR msg_stime
그리고
.BR msg_rtime 는
0으로 설정된다.
.IP
.BR msg_ctime 은
현재 시간으로 설정된다.
.IP
.BR msg_qbytes 는
시스템 제한값
.BR MSGMNB 으로
설정된다.

.PP
만일 메세지 큐가 이미 존재한다면 접근 허가권을 검증하고,
메시지 큐가 소멸되도록 설정되어 있는지를 알아본다.

.SH 반환값
성공시, 반환값은 메세지 큐 식별자(비 음수 정수)가 되며, 그렇지 않으면
에러를 가리키는
.BR errno 와 함께
.BR \-1 이
반환된다.
.SH 에러
실패시,
.BR errno 는
다음 값 중 하나로 설정된다.:
.TP 11
.B EACCES
.IR key 에
해당 하는 메세지 큐가 존재하지만 호출 프로세스가 큐에 대한 접근 허가권을 가지고 있지 않다.
.TP
.B EEXIST
.BR key 에
해당하는 메세지 큐가 존재하며
.IR msgflg 가
.BR IPC_CREAT 와
.BR IPC_EXCL 를
모두 가지고 있다.
.TP
.B EIDRM
메세지 큐가 제거되도록 표시되어 있다.
.TP
.B ENOENT
.IR key 에
해당하는 메세지 큐가 존재하지 않으며
.IR msgflg 에
.BR IPC_CREAT 가
존재하지 않는다.
.TP
.B ENOMEM
메세지 큐가 만들어 졌지만 시스템은 새로운 데이터 구조를 위한 메모리 공간이
충분하지 않다.
.TP
.B ENOSPC
메세지 큐가 만들어 졌지만 시스템 제한 값인 메세지 큐의 최대 수
.RB ( MSGMNI )를
초과했다.
.SH 주의
.BR IPC_PRIVATE 는
플래그 필드가 아니고
.B key_t
타입이다.
이 특별한 값이
.IR key 에
사용된다면, 시스템 콜은
.IR msgflg 의
하위 8비트를 제외한 모든 것을 무시한다.
그리고 성공시 새로운 메세지 큐를 생성한다.
.PP
다음은
.B msgget
함수에 영향을 주는 메세지 큐 자원에 대한 시스템 제한값이다:
.TP 11
.B MSGMNI
메세지 큐의 시스템 최대 수 : 정책에 의존적이다.
.SH 버그
.BR IPC_PRIVATE 의
사용은 할당된 메세지 큐에 접근하는 다른 프로세스를 실제로 막지 못한다.
.PP
파일에서처럼 메세지 큐에 배타적 접근을 보장하도록 프로세스를 위한 내부적
방법은 없다.
단지
.IR msgflg 에
.BR IPC_CREAT 와
.BR IPC_EXCL 를
명시하는 것이 새로운 메세지 큐가 생성되었다는 것을 보장하지만(성공시)
이것이 메세지 큐에 대한 배타적 접근을 암시하는 것은 아니다.
.SH 호환
SVr4, SVID.  SVr4 는 EIDRM 에러 코드를 문서화하지 않았다.
.SH 관련 항목
.BR ftok (3),
.BR ipc (5),
.BR msgctl (2),
.BR msgsnd (2),
.BR msgrcv (2)
.SH 번역
정강훈 <skyeyes@soback.kornet.net> 2000년 6월 19일
.br
한글 Manpage 프로젝트 (http://man.kldp.org) 2005년 2월 15일

